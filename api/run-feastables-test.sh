#!/bin/bash

# –¢–µ—Å—Ç –∫–µ–π—Å–∞ Feastables —Å Brand Gate v2 –∏ Category Guard

echo "üç´ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–µ–π—Å–∞ Feastables Cookies & Creme"
echo "==============================================="
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Node.js
if ! command -v node &> /dev/null; then
    echo "‚ùå Node.js –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Node.js –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–∞."
    exit 1
fi

echo "‚úÖ Node.js –Ω–∞–π–¥–µ–Ω: $(node --version)"
echo ""

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é API
cd "$(dirname "$0")"

echo "üéØ –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º:"
echo "=================="
echo "1. üö´ Brand Gate v2"
echo "   ‚Ä¢ –°—Ç—Ä–æ–≥–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–≤–µ—Å—Ç–Ω–æ–º –±—Ä–µ–Ω–¥–µ (Mr Beast/Feastables)"
echo "   ‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∏–Ω–æ–Ω–∏–º–æ–≤ –±—Ä–µ–Ω–¥–æ–≤ (mrbeast, feastables)"
echo "   ‚Ä¢ Salvage –±—Ä–µ–Ω–¥–æ–≤ –∏–∑ product_name –ø—Ä–∏ –ø—É—Å—Ç—ã—Ö brands_tags"
echo ""
echo "2. üè∑Ô∏è Category Guard"  
echo "   ‚Ä¢ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –º–æ—Ä–æ–∂–µ–Ω–æ–≥–æ –≤–º–µ—Å—Ç–æ —à–æ–∫–æ–ª–∞–¥–∞"
echo "   ‚Ä¢ –ö–∞—Ç–µ–≥–æ—Ä–∏–π–Ω—ã–µ –±–æ–Ω—É—Å—ã/—à—Ç—Ä–∞—Ñ—ã (snack-sweet vs ice-cream)"
echo "   ‚Ä¢ Hard blocking –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø—Ä–∏ –∏–∑–≤–µ—Å—Ç–Ω–æ–º –±—Ä–µ–Ω–¥–µ"
echo ""
echo "3. üîí –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–µ brandless fallback'–∏"
echo "   ‚Ä¢ –ë–µ–∑–±—Ä–µ–Ω–¥–æ–≤—ã–µ –ø–æ–∏—Å–∫–∏ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∏—Å—á–µ—Ä–ø–∞–Ω–∏—è –±—Ä–µ–Ω–¥–æ–≤—ã—Ö"
echo "   ‚Ä¢ Brand Gate v2 –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–∞–∂–µ –≤ split-OR –∑–∞–ø—Ä–æ—Å–∞—Ö"
echo ""
echo "‚ö†Ô∏è  –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:"
echo "   ‚úÖ –ù–ï –¥–æ–ª–∂–µ–Ω –≤—ã–±—Ä–∞—Ç—å –º–æ—Ä–æ–∂–µ–Ω–æ–µ Cookies & Cream (7613312361887)"
echo "   ‚úÖ –î–æ–ª–∂–µ–Ω –Ω–∞–π—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç—ã –±—Ä–µ–Ω–¥–∞ Feastables/Mr Beast"
echo "   ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ snack-sweet (—à–æ–∫–æ–ª–∞–¥) –Ω–∞–¥ ice-cream"
echo ""

# –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º–∏ gate'–∞–º–∏
OFF_USE_SMART_ROUTING=true \
OFF_ENFORCE_BRAND_GATE_V2=true \
OFF_CATEGORY_HARD_BLOCKS_ENABLED=true \
node test-feastables-case.js

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
if [ $? -eq 0 ]; then
    echo ""
    echo "‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–µ–π—Å–∞ Feastables –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
    echo ""
    echo "üìä –ö–ª—é—á–µ–≤—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —É—Å–ø–µ—Ö–∞:"
    echo "   ‚Ä¢ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–æ—Ä–æ–∂–µ–Ω–æ–≥–æ –≤ —Ç–æ–ø-5 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤"
    echo "   ‚Ä¢ –ü—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –±—Ä–µ–Ω–¥–∞ Feastables/Mr Beast"
    echo "   ‚Ä¢ –õ–æ–≥–∏ [BRAND_GATE_V2] –∏ [CATEGORY_GUARD]"
    echo "   ‚Ä¢ –ú–µ—Ç—Ä–∏–∫–∏ brand_gate_blocked –∏ category_conflict_blocked"
else
    echo ""
    echo "‚ùå –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–∏–ª–æ—Å—å —Å –æ—à–∏–±–∫–æ–π"
    exit 1
fi
