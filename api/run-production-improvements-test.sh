#!/bin/bash

# Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ð¹ Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ð°

echo "ðŸš€ Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ð¹ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ð°"
echo "========================================"
echo ""

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ Node.js
if ! command -v node &> /dev/null; then
    echo "âŒ Node.js Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Node.js Ð´Ð»Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ñ‚ÐµÑÑ‚Ð°."
    exit 1
fi

echo "âœ… Node.js Ð½Ð°Ð¹Ð´ÐµÐ½: $(node --version)"
echo ""

# ÐŸÐµÑ€ÐµÑ…Ð¾Ð´Ð¸Ð¼ Ð² Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸ÑŽ API
cd "$(dirname "$0")"

echo "ðŸŽ¯ Ð§Ñ‚Ð¾ Ñ‚ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼:"
echo "=================="
echo "1. ðŸŒ Locale-safe Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð±ÐµÐ· ÑÐ¼ÐµÑˆÐµÐ½Ð¸Ñ ÑÐ·Ñ‹ÐºÐ¾Ð²"
echo "   â€¢ CGI-first Ñ Ñ‚Ð¾Ñ‡Ð½Ñ‹Ð¼Ð¸ Ñ„Ñ€Ð°Ð·Ð°Ð¼Ð¸ Ð¸Ð· off_primary_tokens"
echo "   â€¢ Ð˜ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ ÑÐ¼ÐµÑˆÐ°Ð½Ð½Ñ‹Ñ… Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² (cream montada)"
echo ""
echo "2. ðŸš« Ð–Ñ‘ÑÑ‚ÐºÐ¸Ð¹ Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚Ð½Ñ‹Ð¹ gate"
echo "   â€¢ Ð¤Ð°Ð·Ð° Ð: Ñ‚Ð¾Ð»ÑŒÐºÐ¾ 'Ñ‡Ð¸ÑÑ‚Ñ‹Ðµ' ÐºÐ°Ð½Ð´Ð¸Ð´Ð°Ñ‚Ñ‹ (Ð±ÐµÐ· avoided Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚Ð¾Ð²)"
echo "   â€¢ Ð¤Ð°Ð·Ð° B: 'Ð³Ñ€ÑÐ·Ð½Ñ‹Ðµ' ÐºÐ°Ð½Ð´Ð¸Ð´Ð°Ñ‚Ñ‹ Ñ Ð¿Ð¾Ð½Ð¸Ð¶ÐµÐ½Ð½Ð¾Ð¹ ÑƒÐ²ÐµÑ€ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒÑŽ"
echo "   â€¢ Ð¡Ð½Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ð±Ñ€ÐµÐ½Ð´-Ð±ÑƒÑÑ‚Ð¾Ð² Ð´Ð»Ñ Ð¸Ð·Ð±ÐµÐ¶Ð°Ð½Ð¸Ñ light/zero/spray"
echo ""
echo "3. âœ¨ Clean-first Ð²Ñ‹Ð±Ð¾Ñ€"
echo "   â€¢ ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚ brandMatch + no-avoid ÐºÐ°Ð½Ð´Ð¸Ð´Ð°Ñ‚Ð¾Ð²"
echo "   â€¢ Ð¦ÐµÐ»ÐµÐ²Ð¾Ð¹ rescue Ð¿ÐµÑ€ÐµÐ´ Ð´ÐµÐ³Ñ€Ð°Ð´Ð°Ñ†Ð¸ÐµÐ¹"
echo "   â€¢ ÐšÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ð¸Ñ€ÑƒÐµÐ¼Ñ‹Ð¹ no_candidates Ð²Ð¼ÐµÑÑ‚Ð¾ 'Ð³Ñ€ÑÐ·Ð½Ð¾Ð³Ð¾' Ð²Ñ‹Ð±Ð¾Ñ€Ð°"
echo ""
echo "â±ï¸  ÐŸÑ€Ð¸Ð¼ÐµÑ€Ð½Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ: ~45 ÑÐµÐºÑƒÐ½Ð´"
echo ""

# Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ñ‚ÐµÑÑ‚ Ñ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ñ‹Ð¼Ð¸ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸ÑÐ¼Ð¸
OFF_USE_SMART_ROUTING=true node test-production-improvements.js

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚
if [ $? -eq 0 ]; then
    echo ""
    echo "âœ… Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ð¹ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!"
    echo ""
    echo "ðŸ“Š ÐšÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸ Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°:"
    echo "   â€¢ Success@1 rate - Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ >50% Ð´Ð»Ñ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ð±Ñ€ÐµÐ½Ð´Ð¾Ð²"
    echo "   â€¢ Clean phase usage - Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ >80%"
    echo "   â€¢ Degraded selections - Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ <20%"
    echo "   â€¢ API routing accuracy - Ð´Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ 100%"
    echo ""
    echo "ðŸŽ¯ Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ ÑˆÐ°Ð³Ð¸:"
    echo "   â€¢ ÐÐ½Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð°"
    echo "   â€¢ ÐÐ°ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ÑŒ Ð¿Ð¾Ñ€Ð¾Ð³Ð¸ Ð¿Ð¾Ð´ Ñ€ÐµÐ°Ð»ÑŒÐ½ÑƒÑŽ Ð½Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ"
    echo "   â€¢ ÐÐºÑ‚Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð² Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ðµ Ñ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð¾Ð¼"
else
    echo ""
    echo "âŒ Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐ¸Ð»Ð¾ÑÑŒ Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ¾Ð¹"
    exit 1
fi
