# üöÄ –ê–∫—Ç–∏–≤–∞—Ü–∏—è —É–ª—É—á—à–µ–Ω–∏–π SAL API –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ê–∫—Ç–∏–≤–∞—Ü–∏—è —É–ª—É—á—à–µ–Ω–∏–π
–î–æ–±–∞–≤—å—Ç–µ –≤ –≤–∞—à–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
OFF_BRAND_VARIANT_MAX_PAGES=15      # –£–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ –¥–ª—è brand+variant
OFF_BRAND_BOOST_MULTIPLIER=2.0      # –ë–æ–Ω—É—Å –∑–∞ —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –±—Ä–µ–Ω–¥–∞
OFF_SEARCH_MAX_PAGES=8              # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ –¥–ª—è brand-only

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
OFF_RESCUE_EXTRA_PAGES=5            # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è rescue
OFF_FALLBACK_PAGE_SIZE=30           # –†–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è fallback –ø–æ–∏—Å–∫–∞
```

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —É–ª—É—á—à–µ–Ω–∏–π
cd api
node test-improvements-with-delays.js

# –¢–µ—Å—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞ Central Lechera Asturiana
node test-sal-behavior.js
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:

1. **–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –ø–æ–∏—Å–∫–∞**
   - –î–æ: ~2-3 —Å–µ–∫—É–Ω–¥—ã
   - –ü–æ—Å–ª–µ: ~3-15 —Å–µ–∫—É–Ω–¥ (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏)

2. **–£—Å–ø–µ—à–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞**
   - –ü—Ä–æ—Ü–µ–Ω—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –¥–ª—è brand+variant –∫–µ–π—Å–æ–≤
   - –û—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è –Ω–∏—à–µ–≤—ã—Ö –±—Ä–µ–Ω–¥–æ–≤

3. **–ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ OFF API**
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
   - Rate limit —Å–æ–±–ª—é–¥–µ–Ω–∏–µ (2 —Å–µ–∫ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏)

### –õ–æ–≥–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
```javascript
// –ò—â–∏—Ç–µ –≤ –ª–æ–≥–∞—Ö —ç—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:
"[OFF] Brand boost applied"           // –°—Ä–∞–±–æ—Ç–∞–ª brand boost
"[OFF] Early termination"            // –£–º–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞  
"Dynamic search depth"               // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ —É–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è –≥–ª—É–±–∏–Ω–∞
"rescue_exact_phrase_no_brand"       // –°—Ä–∞–±–æ—Ç–∞–ª–∞ rescue —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
```

## üß™ –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ –∫–µ–π—Å—ã

### –¢–µ—Å—Ç 1: Central Lechera Asturiana
```javascript
const testItem = {
  name: 'nata montada',
  brand: 'Central Lechera Asturiana',
  off_primary_tokens: ['nata', 'montada'],
  off_brand_filter: 'central-lechera-asturiana'
};
// –û–∂–∏–¥–∞–µ—Ç—Å—è: –Ω–∞–π–¥–µ–Ω –ø—Ä–æ–¥—É–∫—Ç 8410297121104
```

### –¢–µ—Å—Ç 2: –ú–∞—Å—Å–æ–≤—ã–π –±—Ä–µ–Ω–¥ (–∫–æ–Ω—Ç—Ä–æ–ª—å)
```javascript
const testItem = {
  name: 'chocolate con leche',
  brand: 'Hacendado',
  off_primary_tokens: ['chocolate', 'leche'],
  off_brand_filter: 'hacendado'
};
// –û–∂–∏–¥–∞–µ—Ç—Å—è: –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫, –Ω–∞–π–¥–µ–Ω –≤ –ø–µ—Ä–≤—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
```

## ‚ö†Ô∏è –ß—Ç–æ –º–æ–∂–µ—Ç –ø–æ–π—Ç–∏ –Ω–µ —Ç–∞–∫

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
**–°–∏–º–ø—Ç–æ–º**: –í—Ä–µ–º—è –ø–æ–∏—Å–∫–∞ >30 —Å–µ–∫—É–Ω–¥
**–†–µ—à–µ–Ω–∏–µ**: 
- –£–º–µ–Ω—å—à–∏—Ç—å `OFF_BRAND_VARIANT_MAX_PAGES` –¥–æ 10-12
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å rate limits OFF API

### –ü—Ä–æ–±–ª–µ–º–∞: –¢–∞–π–º–∞—É—Ç—ã API
**–°–∏–º–ø—Ç–æ–º**: –û—à–∏–±–∫–∏ "This operation was aborted"
**–†–µ—à–µ–Ω–∏–µ**:
- –£–≤–µ–ª–∏—á–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å search.openfoodfacts.org

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ –Ω–∞—Ö–æ–¥–∏—Ç –ø—Ä–æ–¥—É–∫—Ç—ã
**–°–∏–º–ø—Ç–æ–º**: Rescue —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç
**–†–µ—à–µ–Ω–∏–µ**:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å brand_filter
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ primary_tokens –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- –ó–∞–ø—É—Å—Ç–∏—Ç—å test-sal-behavior.js –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

## üîÑ –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å—Ç–∞—Ä–æ–π –ª–æ–≥–∏–∫–µ:
```bash
# –û—Ç–∫–ª—é—á–∏—Ç—å –≤—Å–µ —É–ª—É—á—à–µ–Ω–∏—è
unset OFF_BRAND_VARIANT_MAX_PAGES
unset OFF_BRAND_BOOST_MULTIPLIER

# –ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
OFF_SEARCH_MAX_PAGES=5
OFF_BRAND_BOOST_MULTIPLIER=1.0
```

## üìà –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã:
- ‚úÖ –ù–∏—à–µ–≤—ã–µ –±—Ä–µ–Ω–¥—ã —Ç–µ–ø–µ—Ä—å –Ω–∞—Ö–æ–¥—è—Ç—Å—è
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç—å –¥–ª—è brand+variant –∑–∞–ø—Ä–æ—Å–æ–≤  
- ‚úÖ –ú–µ–Ω—å—à–µ "–ª–æ–∂–Ω—ã—Ö" —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ—Ç –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –±—Ä–µ–Ω–¥–æ–≤

### –ö–æ–º–ø—Ä–æ–º–∏—Å—Å—ã:
- ‚è≥ –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–∏—Å–∫–∞ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∫–µ–π—Å–æ–≤
- üì° –ë–æ–ª—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ OFF API
- üíæ –ù–µ–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

## üéØ –£—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–ì–ª–∞–≤–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —É—Å–ø–µ—Ö–∞**: –ü—Ä–æ–¥—É–∫—Ç Central Lechera Asturiana (8410297121104) —Ç–µ–ø–µ—Ä—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø—Ä–∏ –ø–æ–∏—Å–∫–µ "nata montada" + brand filter.

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏**:
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–∞ —É—Å–ø–µ—à–Ω—ã—Ö –ø–æ–∏—Å–∫–æ–≤ –¥–ª—è –Ω–∏—à–µ–≤—ã—Ö –±—Ä–µ–Ω–¥–æ–≤ –Ω–∞ 15-25%
- –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –¥–ª—è –º–∞—Å—Å–æ–≤—ã—Ö –±—Ä–µ–Ω–¥–æ–≤
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 15 —Å–µ–∫—É–Ω–¥ –¥–ª—è 95% –∑–∞–ø—Ä–æ—Å–æ–≤

---

**–ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!** üöÄ

–ó–∞–ø—É—Å—Ç–∏—Ç–µ `node test-improvements-with-delays.js` –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.
