#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É–º–Ω–æ–≥–æ —Ä–æ—É—Ç–∏–Ω–≥–∞

echo "üß† –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–º–Ω–æ–≥–æ —Ä–æ—É—Ç–∏–Ω–≥–∞"
echo "==============================="
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Node.js
if ! command -v node &> /dev/null; then
    echo "‚ùå Node.js –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Node.js –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–∞."
    exit 1
fi

echo "‚úÖ Node.js –Ω–∞–π–¥–µ–Ω: $(node --version)"
echo ""

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é API
cd "$(dirname "$0")"

echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç —É–º–Ω–æ–≥–æ —Ä–æ—É—Ç–∏–Ω–≥–∞..."
echo ""
echo "üìã –ß—Ç–æ –±—É–¥–µ—Ç –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ:"
echo "   üè∑Ô∏è  –õ–æ–∫–∞–ª—å–Ω—ã–µ –±—Ä–µ–Ω–¥—ã ‚Üí CGI API"
echo "   üåç –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –±—Ä–µ–Ω–¥—ã ‚Üí SAL API (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è)"
echo "   ‚ùì –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –±—Ä–µ–Ω–¥—ã ‚Üí –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –ø–æ–∏—Å–∫"
echo "   üìä –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"
echo ""

# –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç —Å —É–º–Ω—ã–º —Ä–æ—É—Ç–∏–Ω–≥–æ–º
OFF_USE_SMART_ROUTING=true node test-smart-routing.js

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
if [ $? -eq 0 ]; then
    echo ""
    echo "‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–º–Ω–æ–≥–æ —Ä–æ—É—Ç–∏–Ω–≥–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!"
    echo ""
    echo "üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç:"
    echo "   ‚Ä¢ –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –≤—ã–±–æ—Ä–∞ API –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –±—Ä–µ–Ω–¥–æ–≤"
    echo "   ‚Ä¢ –ú–µ—Ç—Ä–∏–∫–∏ success@1/3/5 –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞"
    echo "   ‚Ä¢ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π"
    echo "   ‚Ä¢ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å fallback –ª–æ–≥–∏–∫–∏"
else
    echo ""
    echo "‚ùå –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–∏–ª–æ—Å—å —Å –æ—à–∏–±–∫–æ–π"
    exit 1
fi
