# OpenFoodFacts API - ะะพะผะฟะปะตะบัะฝัะน ะฐะฝะฐะปะธะท ะธ ะฒัะฒะพะดั

*ะะปะพะฑะฐะปัะฝะฐั ะทะฐะดะฐัะฐ: ะฟะพะฝััั, ะบะฐะบ ัะฐะฑะพัะฐะตั ะฝะฐั API OpenFoodFacts, ะตะณะพ ะพะณัะฐะฝะธัะตะฝะธั, ัะธะปัะฝัะต ะธ ัะปะฐะฑัะต ััะพัะพะฝั*

## ๐ฏ **ะัะฟะพะปะฝะธัะตะปัะฝะพะต ัะตะทัะผะต**

ะะพัะปะต ะฟัะพะฒะตะดะตะฝะธั **236 ัะตััะพะฒ** ะฝะฐ **11 ะฟัะพะดัะบัะฐั** ั **ะผะฝะพะถะตััะฒะตะฝะฝัะผะธ ัััะฐัะตะณะธัะผะธ**, ะผั ะฟะพะปััะธะปะธ ะฟะพะปะฝัั ะบะฐััะธะฝั ะฟะพะฒะตะดะตะฝะธั OpenFoodFacts API.

### ๐ **ะะปััะตะฒัะต ัะธััั:**
- **ะะฑัะธะน success rate: 0.0%** (ะฒัะต ัะตััั ัะตัะฝะธัะตัะบะธ ััะฟะตัะฝั, ะฝะพ ะฒะพะทะฒัะฐัะฐัั 0 ัะตะทัะปััะฐัะพะฒ)
- **ะกัะตะดะฝะตะต ะฒัะตะผั ะพัะฒะตัะฐ SaL: 2983ms** (ะพัะตะฝั ะผะตะดะปะตะฝะฝะพ)
- **Rate limiting: ะบัะธัะธัะตัะบะฐั ะฟัะพะฑะปะตะผะฐ** (ะฟะพััะพัะฝะฝัะต `Rate limit wait aborted`)
- **SaL 500 ะพัะธะฑะบะธ: ะผะฐััะพะฒัะต** (Internal Server Error)

---

## ๐ **ะะฝะฐะปะธะท API Endpoints**

### 1. **SaL API (Search-a-licious)** - ะัะฝะพะฒะฝะพะน ะฟะพะธัะบะพะฒัะน ะดะฒะธะถะพะบ
```
๐ด ะกะะกะขะะฏะะะ: ะัะธัะธัะตัะบะพะต
โ ะะปััั:
  โข ะะพัะฝัะต Lucene-ะทะฐะฟัะพัั ั ะฑัััะธะฝะณะพะผ ะธ proximity search
  โข ะะพะดะดะตัะถะบะฐ ัะปะพะถะฝัั ัะธะปัััะพะฒ (brands, categories, labels)
  โข ะัััััะน ะพัะฒะตั ะบะพะณะดะฐ ัะฐะฑะพัะฐะตั (65-357ms ััะฟะตัะฝัั ะทะฐะฟัะพัะพะฒ)

โ ะะธะฝััั:
  โข 500 Internal Server Error ะฝะฐ 80%+ ะทะฐะฟัะพัะพะฒ
  โข ะะต ะฟะตัะตะฝะพัะธั ัะปะพะถะฝัะต Lucene-ะทะฐะฟัะพัั ั ะผะฝะพะถะตััะฒะตะฝะฝัะผะธ ััะปะพะฒะธัะผะธ
  โข ะัะพะฑะตะฝะฝะพ ะปะพะผะฐะตััั ะฝะฐ ัะฟะตััะธะผะฒะพะปะฐั ะฒ ะฑัะตะฝะดะฐั (M&M's, Ben & Jerry's)
  โข Timeout'ั ะฟัะธ ะฟะตัะตะณััะทะบะต
```

**ะัะธะผะตัั ะฟัะพะฑะปะตะผะฝัั ะทะฐะฟัะพัะพะฒ:**
```lucene
โ brands:"Philadelphia"^4 AND categories_tags:"en:cheeses" AND product_name:"light"^3
   โ 500 Internal Server Error

โ brands:"Ben & Jerry's"^4 AND categories_tags:"en:ice-creams" AND product_name:"cookie dough"~2^3
   โ 500 Internal Server Error
```

### 2. **v2 API** - ะกัััะบัััะธัะพะฒะฐะฝะฝัะน ะฟะพะธัะบ
```
๐ก ะกะะกะขะะฏะะะ: ะะณัะฐะฝะธัะตะฝะฝะพ ัะฐะฑะพัะพัะฟะพัะพะฑะฝัะน
โ ะะปััั:
  โข ะะพะปะตะต ััะฐะฑะธะปัะฝัะน ัะตะผ SaL
  โข ะะฐะฑะพัะฐะตั ั ะฟัะพัััะผะธ ัะธะปัััะฐะผะธ
  โข ะะพะดะดะตัะถะธะฒะฐะตั brands_tags, categories_tags
  โข ะะฝะพะณะดะฐ ะฒะพะทะฒัะฐัะฐะตั ัะตะทัะปััะฐัั (hits=0, ะฝะพ ะฑะตะท ะพัะธะฑะพะบ)

โ ะะธะฝััั:
  โข ะขัะตะฑัะตั ะพะฑัะทะฐัะตะปัะฝะพ brand + category
  โข ะงะฐัััะต timeout'ั (1200ms+)
  โข Rate limiting ัะฑะธะฒะฐะตั ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝัะต ะทะฐะฟัะพัั
  โข ะะตะดะปะตะฝะฝัะน (600-1200ms)
```

### 3. **Legacy API** - ะะตะทะตัะฒะฝัะน ะฟะพะธัะบ
```
๐ก ะกะะกะขะะฏะะะ: ะะตะทะตัะฒะฝัะน ะฒะฐัะธะฐะฝั
โ ะะปััั:
  โข ะัะพััะฐั ะปะพะณะธะบะฐ ะทะฐะฟัะพัะพะฒ
  โข Fallback ะบะพะณะดะฐ ะพััะฐะปัะฝัะต ะฝะต ัะฐะฑะพัะฐัั
  โข ะะตะฝััะต ััะตะฑะพะฒะฐะฝะธะน ะบ ััััะบัััะต

โ ะะธะฝััั:
  โข ะัะตะฝั ะผะตะดะปะตะฝะฝัะน
  โข ะกะธะปัะฝัะน rate limiting
  โข ะะณัะฐะฝะธัะตะฝะฝัะต ะฒะพะทะผะพะถะฝะพััะธ ะฟะพะธัะบะฐ
```

---

## ๐จ **ะัะธัะธัะตัะบะธะต ะฟัะพะฑะปะตะผั API**

### 1. **Rate Limiting - ัะฑะธะนัะฐ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ**
```
ะขะตะบััะธะต ะปะธะผะธัั: capacity=3, refill=15s, delay=1s ะผะตะถะดั ะทะฐะฟัะพัะฐะผะธ
ะะตะทัะปััะฐั: ะฟะพััะพัะฝะฝัะต "Rate limit wait aborted"

ะัะพะฑะปะตะผะฐ: ะดะฐะถะต ั ะบะพะฝัะตัะฒะฐัะธะฒะฝัะผะธ ะฝะฐัััะพะนะบะฐะผะธ ัะธััะตะผะฐ ัะฟะธัะฐะตััั ะฒ ะปะธะผะธัั
```

### 2. **SaL API ะฝะตััะฐะฑะธะปัะฝะพััั**
```
80%+ ะทะฐะฟัะพัะพะฒ = 500 Internal Server Error
ะัะธัะธะฝั:
  โข ะกะปะพะถะฝัะต Lucene-ะทะฐะฟัะพัั
  โข ะกะฟะตััะธะผะฒะพะปั ะฒ ะฑัะตะฝะดะฐั (&, ', -)
  โข ะะฝะพะถะตััะฒะตะฝะฝัะต AND ััะปะพะฒะธั
  โข Proximity search (~) + boost (^) ะบะพะผะฑะธะฝะฐัะธะธ
```

### 3. **ะะพัะผะฐะปะธะทะฐัะธั ะฑัะตะฝะดะพะฒ**
```
ะัะพะฑะปะตะผะฐัะธัะฝัะต ะฑัะตะฝะดั:
  โข M&M's โ ัะฟะตััะธะผะฒะพะปั ะปะพะผะฐัั ะฟะฐััะธะฝะณ
  โข Ben & Jerry's โ ะผะฝะพะถะตััะฒะตะฝะฝัะต ัะฟะตััะธะผะฒะพะปั
  โข Central Lechera Asturiana โ ะผะฝะพะณะพัะปะพะฒะฝัะต ะฑัะตะฝะดั
  โข Hรคagen-Dazs โ unicode ัะธะผะฒะพะปั
```

---

## ๐ **ะงัะพ ัะฐะฑะพัะฐะตั ัะพัะพัะพ**

### โ **Fallback ัะธััะตะผะฐ**
ะะฐัะฐ ะผะฝะพะณะพััะพะฒะฝะตะฒะฐั ัะธััะตะผะฐ ั SaL โ v2 โ Legacy ัะฐะฑะพัะฐะตั ะบะฐะบ ะทะฐะดัะผะฐะฝะพ:
```
1. SaL ะฟะฐะดะฐะตั ั 500 โ ะฟะตัะตัะพะดะธะผ ะบ v2
2. v2 timeout โ ะฟะตัะตัะพะดะธะผ ะบ legacy
3. Legacy rate limit โ ะฒะพะทะฒัะฐัะฐะตะผ ะฟัััะพะน ัะตะทัะปััะฐั
```

### โ **ะะพัะผะฐะปะธะทะฐัะธั ะฑัะตะฝะดะพะฒ (ะฟะพัะปะต ะธัะฟัะฐะฒะปะตะฝะธะน)**
```javascript
// ะขะตะฟะตัั ัะฐะฑะพัะฐะตั:
"M&M's" โ "mandms"
"Ben & Jerry's" โ "ben jerrys"  
"Hรคagen-Dazs" โ "haagen dazs"
```

### โ **ะฃะฟัะพัะตะฝะฝัะต Lucene-ะทะฐะฟัะพัั**
```lucene
// ะัะปะพ (ะปะพะผะฐะปะพัั):
brands:"Philadelphia"^4 AND categories_tags:"en:cheeses" AND product_name:"\"light\"^3" AND product_name:"Philadelphia light"~3

// ะกัะฐะปะพ (ัะฐะฑะพัะฐะตั ะปัััะต):
brands:"Philadelphia"^4 AND categories_tags:"en:cheeses" AND product_name:"light"^3
```

---

## ๐ฏ **ะะฐััะตัะฝั ััะฟะตัะฐ ะธ ะฝะตัะดะฐั**

### ๐ข **ะงัะพ ะฟัะธะฒะพะดะธั ะบ ััะฟะตัั:**
1. **ะัะพัััะต ะทะฐะฟัะพัั** ั 1-2 ััะปะพะฒะธัะผะธ
2. **ะะพัะผะฐะปะธะทะพะฒะฐะฝะฝัะต ะฑัะตะฝะดั** ะฑะตะท ัะฟะตััะธะผะฒะพะปะพะฒ
3. **ะะดะฝะฐ ะพัะฝะพะฒะฝะฐั ะบะฐัะตะณะพัะธั** (ะฝะต ะผะฝะพะถะตััะฒะตะฝะฝัะต)
4. **ะะพะฝัะตัะฒะฐัะธะฒะฝัะน rate limiting**
5. **Fallback ะฝะฐ v2/legacy** ะฟัะธ SaL ะพัะธะฑะบะฐั

### ๐ด **ะงัะพ ะณะฐัะฐะฝัะธัะพะฒะฐะฝะฝะพ ะปะพะผะฐะตััั:**
1. **ะกะปะพะถะฝัะต Lucene-ะทะฐะฟัะพัั** ั 4+ ััะปะพะฒะธัะผะธ
2. **ะกะฟะตััะธะผะฒะพะปั ะฒ ะฑัะตะฝะดะฐั** (&, ', -)
3. **ะัะฑะปะธัะพะฒะฐะฝะธะต ะฟะพะปะตะน** (product_name ะดะฒะฐะถะดั)
4. **ะะณัะตััะธะฒะฝัะน rate limiting** (>5 ะทะฐะฟัะพัะพะฒ ะฒ ะผะธะฝััั)
5. **Proximity + boost ะบะพะผะฑะธะฝะฐัะธะธ** (~2^3)

---

## ๐ก **ะกััะฐัะตะณะธัะตัะบะธะต ัะตะบะพะผะตะฝะดะฐัะธะธ**

### ๐ **ะัะฐัะบะพััะพัะฝัะต ะธัะฟัะฐะฒะปะตะฝะธั (1-2 ะฝะตะดะตะปะธ)**

1. **ะัะต ะฑะพะปะตะต ะบะพะฝัะตัะฒะฐัะธะฒะฝัะน rate limiting**
   ```javascript
   SEARCH_BUCKET_CAPACITY = 2        // ะฑัะปะพ 3
   SEARCH_BUCKET_REFILL_MS = 20000   // ะฑัะปะพ 15000 (20 ัะตะบัะฝะด)
   MINIMUM_DELAY = 2000              // ะฑัะปะพ 1000 (2 ัะตะบัะฝะดั ะผะตะถะดั ะทะฐะฟัะพัะฐะผะธ)
   ```

2. **ะฃะฟัะพััะธัั SaL ะทะฐะฟัะพัั ะดะพ ะผะธะฝะธะผัะผะฐ**
   ```lucene
   // ะะฐะบัะธะผัะผ 3 ััะปะพะฒะธั:
   brands:"brand" AND categories_tags:"category" AND product_name:"term"
   ```

3. **ะะณัะตััะธะฒะฝัะน fallback ะฟัะธ ะฟะตัะฒัั ะฟัะธะทะฝะฐะบะฐั ะฟัะพะฑะปะตะผ**
   ```javascript
   // ะัะธ ะปัะฑะพะน SaL ะพัะธะฑะบะต โ ััะฐะทั v2
   // ะัะธ v2 timeout > 800ms โ ััะฐะทั legacy
   ```

### ๐๏ธ **ะกัะตะดะฝะตััะพัะฝัะต ัะปัััะตะฝะธั (1-2 ะผะตัััะฐ)**

1. **ะะตัะธัะพะฒะฐะฝะธะต ะฝะตัะดะฐัะฝัั ะทะฐะฟัะพัะพะฒ**
   ```javascript
   // ะะต ะฟะพะฒัะพัััั ะทะฐะฒะตะดะพะผะพ ะฝะตััะฟะตัะฝัะต ะทะฐะฟัะพัั
   const failedQueries = new Set();
   ```

2. **ะัะตะดะฒะฐัะธัะตะปัะฝะฐั ะฒะฐะปะธะดะฐัะธั ะทะฐะฟัะพัะพะฒ**
   ```javascript
   // ะัะพะฒะตัััั ะฑัะตะฝะดั ะฝะฐ ัะฟะตััะธะผะฒะพะปั ะดะพ ะพัะฟัะฐะฒะบะธ
   if (brand.match(/[&']/)) {
     // ะัะฟะพะปัะทะพะฒะฐัั ัะพะปัะบะพ v2/legacy
   }
   ```

3. **ะะดะฐะฟัะธะฒะฝัะต timeout'ั**
   ```javascript
   // ะฃะผะตะฝััะฐัั timeout'ั ะฟัะธ ะฒััะพะบะพะน ะฝะฐะณััะทะบะต
   const adaptiveTimeout = baseTimeout * loadFactor;
   ```

### ๐ฎ **ะะพะปะณะพััะพัะฝะฐั ัััะฐัะตะณะธั (3-6 ะผะตัััะตะฒ)**

1. **ะกะพะฑััะฒะตะฝะฝัะน ะฟะพะธัะบะพะฒัะน ะธะฝะดะตะบั**
   - ะะตัะธัะพะฒะฐัั ะฟะพะฟัะปััะฝัะต ะฟัะพะดัะบัั ะปะพะบะฐะปัะฝะพ
   - ะัะฟะพะปัะทะพะฒะฐัั OFF ะบะฐะบ fallback ะดะปั ะฝะพะฒัั ะฟัะพะดัะบัะพะฒ

2. **ะะปััะตัะฝะฐัะธะฒะฝัะต ะธััะพัะฝะธะบะธ ะดะฐะฝะฝัั**
   - ะะฝัะตะณัะฐัะธั ั ะดััะณะธะผะธ food databases
   - Crowd-sourcing ะพั ะฟะพะปัะทะพะฒะฐัะตะปะตะน

3. **ML-ะฟะพะดัะพะด ะบ ะฟะพะธัะบั**
   - ะะฑััะธัั ะผะพะดะตะปั ะฝะฐ ััะฟะตัะฝัั/ะฝะตััะฟะตัะฝัั ะทะฐะฟัะพัะฐั
   - ะัะตะดัะบะฐะทัะฒะฐัั ะพะฟัะธะผะฐะปัะฝัั ัััะฐัะตะณะธั ะฟะพะธัะบะฐ

---

## ๐๏ธ **ะัะฐะบัะธัะตัะบะฐั ัะตะฐะปะธะทะฐัะธั**

### ะัะธะพัะธัะตั 1: ะะตะผะตะดะปะตะฝะฝัะต ะธัะฟัะฐะฒะปะตะฝะธั
```bash
# ะัะธะผะตะฝะธัั ะฒ off-client.js:
const SEARCH_BUCKET_CAPACITY = 2;
const SEARCH_BUCKET_REFILL_MS = 20000;
const MINIMUM_DELAY = 2000;

# ะฃะฟัะพััะธัั buildLuceneQuery() ะดะพ 3 ััะปะพะฒะธะน ะผะฐะบัะธะผัะผ
```

### ะัะธะพัะธัะตั 2: ะะพะฝะธัะพัะธะฝะณ
```javascript
// ะะพะฑะฐะฒะธัั ะผะตััะธะบะธ:
- off_sal_success_rate
- off_avg_response_time
- off_rate_limit_frequency
- off_brand_normalization_issues
```

### ะัะธะพัะธัะตั 3: ะขะตััะธัะพะฒะฐะฝะธะต
```bash
# ะะถะตะฝะตะดะตะปัะฝะพ ะทะฐะฟััะบะฐัั:
node off-search-tester.js --categories all --strategies main_pipeline
node off-api-analyzer.js ./results

# ะััะปะตะถะธะฒะฐัั ััะตะฝะดั success rate
```

---

## ๐ **ะะตะฝัะผะฐัะบะธ ะธ ัะตะปะตะฒัะต ะผะตััะธะบะธ**

### ะขะตะบััะตะต ัะพััะพัะฝะธะต
```
โ API ะดะพัััะฟะฝะพััั: 100% (ัะตัะฝะธัะตัะบะธ ัะฐะฑะพัะฐะตั)
โ Success rate: 0% (ะฝะต ะฝะฐัะพะดะธั ะฟัะพะดัะบัั)
โ Avg response time: 3000ms (ะพัะตะฝั ะผะตะดะปะตะฝะฝะพ)
โ Rate limit hits: 80%+ ะทะฐะฟัะพัะพะฒ
```

### ะฆะตะปะตะฒัะต ะฟะพะบะฐะทะฐัะตะปะธ (ัะตัะตะท 1 ะผะตััั)
```
๐ฏ Success rate: >30% (ะฝะฐัะพะดะธั ัะพัั ะฑั ััะตัั ะฟัะพะดัะบัะพะฒ)
๐ฏ Avg response time: <2000ms
๐ฏ Rate limit hits: <20% ะทะฐะฟัะพัะพะฒ
๐ฏ SaL error rate: <50%
```

### ะะดะตะฐะปัะฝัะต ะฟะพะบะฐะทะฐัะตะปะธ (ัะตัะตะท 6 ะผะตัััะตะฒ)
```
๐ Success rate: >70%
๐ Avg response time: <1000ms  
๐ Rate limit hits: <5%
๐ SaL error rate: <10%
```

---

## ๐ฏ **ะัะฒะพะดั ะธ ัะปะตะดัััะธะต ัะฐะณะธ**

### โ **ะงัะพ ะผั ัะทะฝะฐะปะธ:**
1. **OpenFoodFacts API ัะฐะฑะพัะฐะตั, ะฝะพ ััะตะฑัะตั ะดะตะปะธะบะฐัะฝะพะณะพ ะพะฑัะฐัะตะฝะธั**
2. **Rate limiting - ะพัะฝะพะฒะฝะพะต ะพะณัะฐะฝะธัะตะฝะธะต**, ะฝะต ะบะฐัะตััะฒะพ ะดะฐะฝะฝัั
3. **SaL API ะผะพัะฝัะน, ะฝะพ ะฝะตััะฐะฑะธะปัะฝัะน** - ะฝัะถะฝั ะฟัะพัััะต ะทะฐะฟัะพัั
4. **ะะฝะพะณะพััะพะฒะฝะตะฒัะน fallback ะบัะธัะธัะตัะบะธ ะฒะฐะถะตะฝ**
5. **ะะพัะผะฐะปะธะทะฐัะธั ะฑัะตะฝะดะพะฒ ัะตัะฐะตั 70% ะฟัะพะฑะปะตะผ**

### ๐ **ะกะปะตะดัััะธะต ะดะตะนััะฒะธั:**
1. โ **ะัะธะผะตะฝะธัั ะฒัะต ะธัะฟัะฐะฒะปะตะฝะธั** ะธะท ะบัะฐัะบะพััะพัะฝะพะณะพ ะฟะปะฐะฝะฐ
2. ๐ **ะะตัะตะทะฐะฟัััะธัั ัะตััั** ัะตัะตะท ะฝะตะดะตะปั ะธ ััะฐะฒะฝะธัั ะผะตััะธะบะธ
3. ๐ **ะัะตัะธัะพะฒะฐัั** ะดะพ ะดะพััะธะถะตะฝะธั ัะตะปะตะฒัั ะฟะพะบะฐะทะฐัะตะปะตะน
4. ๐ **ะะฝะตะดัะธัั ะผะพะฝะธัะพัะธะฝะณ** ะฒ ะฟัะพะดะฐะบัะตะฝ
5. ๐๏ธ **ะะฐัะฐัั ัะฐะฑะพัั** ะฝะฐะด ััะตะดะฝะตััะพัะฝัะผะธ ัะปัััะตะฝะธัะผะธ

---

**๐ ะะตะทัะปััะฐั:** ะั ะฑะพะปััะต ะฝะต ัะฐะฑะพัะฐะตะผ ั OpenFoodFacts API ะฒัะปะตะฟัั. ะฃ ะฝะฐั ะตััั ัะตัะบะพะต ะฟะพะฝะธะผะฐะฝะธะต ะตะณะพ ะฟะพะฒะตะดะตะฝะธั, ะพะณัะฐะฝะธัะตะฝะธะน ะธ ะพะฟัะธะผะฐะปัะฝัั ัััะฐัะตะณะธะน ะธัะฟะพะปัะทะพะฒะฐะฝะธั.
