# üîç CGI Search Implementation

## üìã –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ CGI API OpenFoodFacts –∫–∞–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ SAL API —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Ñ–ª–∞–≥ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

**CGI API –ø–æ–∫–∞–∑–∞–ª –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ª—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –Ω–∏—à–µ–≤—ã—Ö –±—Ä–µ–Ω–¥–æ–≤:**

| –ü—Ä–æ–¥—É–∫—Ç | SAL –ø–æ–∑–∏—Ü–∏—è | CGI –ø–æ–∑–∏—Ü–∏—è | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-------------|-------------|-----------|
| Central Lechera Asturiana Nata Montada | 216 | **1** | **216x –ª—É—á—à–µ** |
| Central Lechera Asturiana Nata ligera | 21 | **2** | **10x –ª—É—á—à–µ** |
| Central Lechera Asturiana sin lactosa | –Ω–µ –Ω–∞–π–¥–µ–Ω | **1** | **‚àû –ª—É—á—à–µ** |

## üöÄ –ê–∫—Ç–∏–≤–∞—Ü–∏—è CGI –ø–æ–∏—Å–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è —Å—Ä–µ–¥—ã:
```bash
export OFF_USE_CGI_SEARCH=true
```

### –í .env —Ñ–∞–π–ª–µ:
```
OFF_USE_CGI_SEARCH=true
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏:
```bash
# –° CGI API
OFF_USE_CGI_SEARCH=true node your-app.js

# –° SAL API (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
node your-app.js
```

## üìÅ –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

### –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
- `modules/nutrition/off/client/search-cgi.js` - CGI –ø–æ–∏—Å–∫–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç
- `modules/nutrition/off/client/config.js` - –¥–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ `USE_CGI_SEARCH`
- `modules/nutrition/off/client/search-pipeline.js` - –æ–±–Ω–æ–≤–ª—ë–Ω –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ CGI

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- `sal-vs-cgi-comparison.js` - —Å–∫—Ä–∏–ø—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏—è API
- `run-sal-vs-cgi-test.sh` - –∑–∞–ø—É—Å–∫ —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
- `test-cgi-search.js` - —Ç–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ CGI
- `run-cgi-test.sh` - –∑–∞–ø—É—Å–∫ CGI —Ç–µ—Å—Ç–æ–≤

### –û—Ç—á—ë—Ç—ã:
- `relevance-analysis-report.md` - –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
- `search-strategy-recommendations.md` - —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### Fallback –ª–æ–≥–∏–∫–∞:
1. **–û—Å–Ω–æ–≤–Ω–æ–π API** (–ø–æ —Ñ–ª–∞–≥—É): CGI –∏–ª–∏ SAL
2. **Fallback**: –ø—Ä–∏ –æ—à–∏–±–∫–µ CGI ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ SAL
3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: —á—ë—Ç–∫–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ API

### CGI API –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- **Endpoint**: `https://world.openfoodfacts.org/cgi/search.pl`
- **–ú–µ—Ç–æ–¥**: GET —Å query parameters
- **–õ–∏–º–∏—Ç**: 100 –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –Ω–∞ –∑–∞–ø—Ä–æ—Å
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: —á–µ—Ä–µ–∑ `tagtype_0=brands&tag_0=BrandName`

## üìä –õ–æ–≥–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### CGI API –ª–æ–≥–∏:
```
[OFF] CGI query - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
[OFF] CGI search results - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞  
[OFF] CGI search successful - —É—Å–ø–µ—à–Ω—ã–π –ø–æ–∏—Å–∫
```

### SAL API –ª–æ–≥–∏:
```
[OFF] query - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
[OFF] search page summary - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
[OFF] SAL search successful - —É—Å–ø–µ—à–Ω—ã–π –ø–æ–∏—Å–∫
```

### Fallback –ª–æ–≥–∏:
```
[OFF] CGI search failed - –æ—à–∏–±–∫–∞ CGI
[OFF] Trying SAL fallback... - –ø–æ–ø—ã—Ç–∫–∞ fallback
[OFF] SAL fallback successful - —É—Å–ø–µ—à–Ω—ã–π fallback
```

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CGI:
- ‚úÖ –ù–∏—à–µ–≤—ã–µ –µ–≤—Ä–æ–ø–µ–π—Å–∫–∏–µ –±—Ä–µ–Ω–¥—ã
- ‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã (Central Lechera Asturiana, Hacendado)
- ‚úÖ –ö–æ–≥–¥–∞ –≤–∞–∂–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç—å —Ç–æ–ø-3 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SAL:
- ‚úÖ –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ –±—Ä–µ–Ω–¥—ã (Coca-Cola, Pepsi, Nestl√©)
- ‚úÖ –ö–æ–≥–¥–∞ –Ω—É–∂–µ–Ω –≥–ª—É–±–æ–∫–∏–π –ø–æ–∏—Å–∫ (100+ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
- ‚úÖ –†–µ–¥–∫–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã —Å –Ω–∏–∑–∫–æ–π –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å—é

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤:
```bash
./run-sal-vs-cgi-test.sh
```

### –¢–µ—Å—Ç CGI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:
```bash
./run-cgi-test.sh
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤:
- `sal-vs-cgi-results_[timestamp].json`
- –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è

### –≠—Ç–∞–ø 1: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –í–∫–ª—é—á–∏—Ç—å CGI –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
export OFF_USE_CGI_SEARCH=true
```

### –≠—Ç–∞–ø 2: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ `[OFF] CGI query`
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å fallback –Ω–∞ SAL –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –≠—Ç–∞–ø 3: –ü—Ä–æ–¥–∞–∫—à–Ω
```bash
# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
OFF_USE_CGI_SEARCH=true
```

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | SAL | CGI | –ü–æ–±–µ–¥–∏—Ç–µ–ª—å |
|---------|-----|-----|------------|
| –°—Ä–µ–¥–Ω—è—è –ø–æ–∑–∏—Ü–∏—è –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ | 88 | **1.7** | üèÜ **CGI** |
| –ü—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ —Ç–æ–ø-10 | 3/8 | **3/3** | üèÜ **CGI** |
| –û–±—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ | **8/9** | 3/9 | üèÜ **SAL** |
| –°–∫–æ—Ä–æ—Å—Ç—å | 3115–º—Å | **2433–º—Å** | üèÜ **CGI** |
| –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å —Ç–æ–ø-1 | 63% | **100%** | üèÜ **CGI** |

## ‚úÖ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

- [x] CGI API –∫–ª–∏–µ–Ω—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] –§–ª–∞–≥ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω
- [x] Fallback –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- [x] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- [x] –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω

**–ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é!** üöÄ
