# üì° Remote Logging Setup - Versailles ‚Üí Local

–°–∏—Å—Ç–µ–º–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤ –∏–∑ Vercel (–ø—Ä–æ–¥–∞–∫—à–Ω) –ø—Ä—è–º–æ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
npm install --save-dev express socket.io cors chalk
```

### 2. –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –ª–æ–≥–æ–≤

```bash
npm run logs
```

–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `http://localhost:3001`

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç—É–Ω–Ω–µ–ª—è (ngrok)

–í –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

```bash
npm run logs:tunnel
```

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL –≤–∏–¥–∞: `https://abc123.ngrok.io`

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Vercel

–î–æ–±–∞–≤—å—Ç–µ –≤ Vercel Dashboard:

```bash
LOCAL_LOG_WEBHOOK_URL=https://abc123.ngrok.io/webhook/logs
LOG_WEBHOOK_SECRET=your-secret-key
```

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:3001` –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:

- üî¥ **–û—à–∏–±–∫–∏** - –≤—ã–¥–µ–ª–µ–Ω—ã –∫—Ä–∞—Å–Ω—ã–º
- üü° **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è** - –≤—ã–¥–µ–ª–µ–Ω—ã –∂–µ–ª—Ç—ã–º  
- üîµ **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** - —Å–∏–Ω–∏–º —Ü–≤–µ—Ç–æ–º
- üîç **–ü–æ–∏—Å–∫** - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–µ–∫—Å—Ç—É
- üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - —Å—á–µ—Ç—á–∏–∫–∏ –ª–æ–≥–æ–≤

### API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

```bash
# –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏
curl http://localhost:3001/api/logs?limit=50

# –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
curl http://localhost:3001/api/logs?level=error

# Webhook –¥–ª—è Vercel
POST http://localhost:3001/webhook/logs
```

### –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥

–í—Å–µ –ª–æ–≥–∏ —Ç–∞–∫–∂–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å —Å —Ü–≤–µ—Ç–æ–≤–æ–π –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π:

```
üì° Received 5 logs from vercel-api:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
14:30:15 INFO [production] [fra1] [OFF] Input item: Coca-Cola Zero Sugar
14:30:16 INFO [production] [fra1] [OFF] Search strategy found 40 products
14:30:16 ERROR [production] [fra1] [OFF] Required tokens penalty applied: -200
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
```

## üõ†Ô∏è –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∫–æ–¥

### –ë–∞–∑–æ–≤–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```javascript
import remoteLogger from './modules/remote-logger.js';

// –û–±—ã—á–Ω—ã–µ –ª–æ–≥–∏
remoteLogger.info('User action completed', { userId: 123 });
remoteLogger.warn('Rate limit approaching', { remaining: 10 });
remoteLogger.error('Database connection failed', { error: err.message });

// OFF-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ª–æ–≥–∏
remoteLogger.offLog('search', 'Found 5 products', { brand: 'Coca-Cola' });
remoteLogger.offError('timeout', error, { stage: 'v2_strict' });

// GPT –ª–æ–≥–∏
remoteLogger.gptLog('Analysis completed', { items: 3, confidence: 0.9 });

// –ú–µ—Ç—Ä–∏–∫–∏
remoteLogger.metric('off_search_duration', 1250, { stage: 'sal' });
```

### –ó–∞–º–µ–Ω–∞ console.log

```javascript
// –ë—ã–ª–æ:
console.log(`[OFF] Found ${products.length} products`);

// –°—Ç–∞–ª–æ:
remoteLogger.offLog('search', `Found ${products.length} products`, { 
  strategy: 'brand_primary' 
});
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ (.env.local)
LOG_SERVER_PORT=3001
LOG_WEBHOOK_SECRET=your-secret-key

# –í Vercel
LOCAL_LOG_WEBHOOK_URL=https://your-ngrok-url.ngrok.io/webhook/logs
LOG_WEBHOOK_SECRET=your-secret-key
VERCEL_ENV=production
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–≥–µ—Ä–∞

```javascript
// api/modules/remote-logger.js
const remoteLogger = new RemoteLogger({
  maxBufferSize: 100,        // –ú–∞–∫—Å –ª–æ–≥–æ–≤ –≤ –±—É—Ñ–µ—Ä–µ
  flushIntervalMs: 2000,     // –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—Ç–ø—Ä–∞–≤–∫–∏ (–º—Å)
  timeout: 5000              // –¢–∞–π–º–∞—É—Ç HTTP –∑–∞–ø—Ä–æ—Å–∞
});
```

## üìä –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è
- –õ–æ–≥–∏ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –≤ –±—É—Ñ–µ—Ä–µ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø–∞—á–∫–∞–º–∏
- –û—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
- Graceful shutdown —Å —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–æ–π

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫
- –§–∏–ª—å—Ç—Ä –ø–æ —É—Ä–æ–≤–Ω—é –ª–æ–≥–æ–≤ (error, warn, info, debug)
- –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º
- –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –Ω–æ–≤—ã–º –ª–æ–≥–∞–º

### –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å
- –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ webhook'–∞
- Retry –ª–æ–≥–∏–∫–∞ –¥–ª—è –Ω–µ—É–¥–∞—á–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤–æ–∫
- –õ–æ–∫–∞–ª—å–Ω–æ–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ console

## üé® –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

### –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞

–ò–∑–º–µ–Ω–∏—Ç–µ CSS –≤ `local-log-server.js`:

```css
.log-error { border-left-color: #f44336; }  /* –ö—Ä–∞—Å–Ω—ã–π */
.log-warn { border-left-color: #FF9800; }   /* –û—Ä–∞–Ω–∂–µ–≤—ã–π */
.log-info { border-left-color: #2196F3; }   /* –°–∏–Ω–∏–π */
.log-debug { border-left-color: #666; }     /* –°–µ—Ä—ã–π */
```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è

–î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–µ –ø–æ–ª—è –≤ –ª–æ–≥–∏:

```javascript
remoteLogger.info('Custom event', {
  userId: 123,
  sessionId: 'abc-123',
  feature: 'nutrition-analysis',
  duration: 1500
});
```

## üö® –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS —Ç—É–Ω–Ω–µ–ª—å (ngrok –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–∞–¥–µ–∂–Ω—ã–π `LOG_WEBHOOK_SECRET`
- –ù–µ –ª–æ–≥–∏—Ä—É–π—Ç–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ç–æ–∫–µ–Ω—ã, –ø–∞—Ä–æ–ª–∏)
- –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ —Ä–∞–∑–º–µ—Ä –ª–æ–≥–æ–≤ –∏ —á–∞—Å—Ç–æ—Ç—É –æ—Ç–ø—Ä–∞–≤–∫–∏

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash
# –¢–µ—Å—Ç webhook'–∞
curl -X POST http://localhost:3001/webhook/logs \
  -H "Authorization: Bearer your-secret-key" \
  -H "Content-Type: application/json" \
  -d '{"logs":[{"timestamp":"2024-01-01T12:00:00Z","level":"info","message":"Test log","meta":{}}],"source":"test"}'
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å ngrok

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Ç—É–Ω–Ω–µ–ª—è
curl http://localhost:4040/api/tunnels

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç—É–Ω–Ω–µ–ª—å
pkill ngrok && npm run logs:tunnel
```

### –õ–æ–≥–∏ –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Vercel Dashboard
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ ngrok —Ç—É–Ω–Ω–µ–ª—å –∞–∫—Ç–∏–≤–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∫–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `remoteLogger` –≤–º–µ—Å—Ç–æ `console.log`
4. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ Vercel Functions –¥–ª—è –æ—à–∏–±–æ–∫ HTTP

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–æ–≥–æ–≤
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
- –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (WebSocket)

–ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–æ–¥–∞–∫—à–Ω –ø—Ä–æ–±–ª–µ–º –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏! üéâ
